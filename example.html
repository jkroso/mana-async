<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>mana-result example</title>
    <style media="screen">
      body {
        margin: 0;
        font-family: sans-serif;
        font-size: 60pt;
        position: absolute;
        left: calc(50% - 30pt);
        top: calc(50% - 30pt);
      }
      .loading {
        opacity: 0.2;
      }
      .error {
        color: red;
      }
    </style>
    <script type="text/javascript">
      import {pending,wrap} from 'result'
      import {App,JSX} from 'mana'
      import State from './index'

      var count = 0
      setInterval(() => {
        app.cursor.value = pending()
        setTimeout(() => {
          if (Math.random() < 0.5)
            app.cursor.value.error(++count)
          else
            app.cursor.value.write(++count)
        }, 1e3)
      }, 3e3)

      const app = new App(wrap(count), cursor => {
        const pending = ({previousNode}) => <div class="loading">{previousNode || 'pending'}</div>
        const done = ({params}) => <span class="done">{params.promise.value}</span>
        const fail = ({params}) => <span class="error">{params.promise.value}</span>
        return <State promise={cursor.value} pending done fail/>
      })

      window.onload = () => app.mountIn(document.body)
    </script>
  </head>
  <body></body>
</html>
